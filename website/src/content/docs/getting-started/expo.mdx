---
title: Expo
description: Learn how to use LiveStore with Expo.
---

import { Steps, Tabs, TabItem } from '@astrojs/starlight/components'

### Requirements

- [LiveStore](/) is compatible with [Expo SDK 52](https://docs.expo.dev/versions/latest/) and later.
- Ensure your project has the [New Architecture](https://docs.expo.dev/guides/new-architecture/) enabled. This is required for transactional state updates. When you create a new project using Expo SDK 52, this setting is enabled by default.
- LiveStore requires [expo-sqlite](https://docs.expo.dev/versions/latest/sdk/sqlite/) as a peer dependency.

### Quick start

For a quick start we recommend using our template app following the steps below.

For existing projects see [Existing project setup](#existing-project-setup).

<Steps>

1.  **Set up project from template**

    ```bash
    npx tiged --mode=git https://github.com/livestorejs/examples/expo-app my-livestore-app
    ```

    Replace `my-livestore-app` with your desired app name.

2.  **Install dependencies**

    It's strongly recommended to use `bun` for the simplest and most reliable dependency setup.

            <Tabs syncKey="package-manager">

        <TabItem label="bun">

    `bun install`

                	You can ignore the peer-dependency warnings.
                </TabItem>
                <TabItem label="pnpm">
                	`pnpm install --node-linker=hoisted`

                	Make sure to use `--node-linker=hoisted` when installing dependencies in your project or add it to your `.npmrc` file.
                	```
                	# .npmrc
                	nodeLinker=hoisted
                	```

                	Hopefully Expo will also support non-hoisted setups in the future.
                </TabItem>
                <TabItem label="npm">
                	Given `npm` doesn't automatically install peer dependencies you'll also need to also install the following peer dependencies:
                	```
                	npm install @effect/experimental @effect/opentelemetry @effect/platform @effect/platform-browser @effect/schema @opentelemetry/api effect
                	```

                	Going forward you can use `npm install` again to install the dependencies.
                </TabItem>
                <TabItem label="yarn">
                	When using `yarn`, make sure you're using Yarn 4 or higher with the `node-modules` linker.

                	```
                	yarn set version stable
                	yarn config set nodeLinker node-modules
                	yarn install
                	```

                	Additionally, given `yarn` doesn't automatically install peer dependencies you'll also need to install the following peer dependencies:
                	```
                	yarn add @effect/experimental @effect/opentelemetry @effect/platform @effect/platform-browser @effect/schema @opentelemetry/api effect
                	```
                </TabItem>

            </Tabs>

    Pro tip: You can use [direnv](https://direnv.net/) to manage environment variables.

3.  **Run the app**

    <Tabs syncKey="package-manager">
      <TabItem label="bun">`bun ios` or `bun android`</TabItem>
      <TabItem label="pnpm">`pnpm ios` or `pnpm android`</TabItem>
      <TabItem label="npm">`npm run ios` or `npm run android`</TabItem>
      <TabItem label="yarn">`yarn ios` or `yarn android`</TabItem>
    </Tabs>

</Steps>

### Existing project setup

<Steps>

1.  **Create a new Expo project**

    If you already have an Expo project with the new architecture enabled, skip to step 2.

    To create a new Expo project, run one of the following commands based on your package manager:

    <Tabs syncKey="package-manager">
      <TabItem label="bun">`bun create expo-app --template default@latest`</TabItem>
      <TabItem label="pnpm">`pnpm create expo-app --template default@latest`</TabItem>
      <TabItem label="yarn">`yarn create expo-app --template default@latest`</TabItem>
      <TabItem label="npm">`npx create-expo-app@latest`</TabItem>
    </Tabs>

2.  **Install dependencies**

    ```bash
    npx expo install @livestore/devtools-expo @livestore/expo @livestore/livestore @livestore/react @livestore/utils effect expo-sqlite
    ```

3.  **Add Vite meta plugin to babel config file**

    LiveStore Devtools uses Vite. This plugin emulates Vite's `import.meta.env` functionality.

    <Tabs syncKey="package-manager">
      <TabItem label="bun">`bun add -d babel-plugin-transform-vite-meta-env`</TabItem>
      <TabItem label="pnpm">`pnpm add -D babel-plugin-transform-vite-meta-env`</TabItem>
      <TabItem label="yarn">`yarn add -D babel-plugin-transform-vite-meta-env`</TabItem>
      <TabItem label="npm">`npm install --save-dev babel-plugin-transform-vite-meta-env`</TabItem>
    </Tabs>

    In your `babel.config.js` file, add the plugin as follows:

    ```js
    module.exports = function (api) {
      api.cache(true)
      return {
        presets: ['babel-preset-expo'],
        plugins: ['babel-plugin-transform-vite-meta-env', '@babel/plugin-syntax-import-attributes'],
      }
    }
    ```

4.  **Update Metro config**

    Add the following code to your `metro.config.js` file:

    ```js
    const { getDefaultConfig } = require('expo/metro-config')
    const { addLiveStoreDevtoolsMiddleware } = require('@livestore/devtools-expo')

    /** @type {import('expo/metro-config').MetroConfig} */
    const config = getDefaultConfig(__dirname)

    config.resolver.unstable_enableSymlinks = true
    config.resolver.unstable_enablePackageExports = true
    config.resolver.unstable_conditionNames = ['require', 'default']

    // Add LiveStore Devtools middleware only in a local development environment
    if (!process.env.CI && process.stdout.isTTY) {
      addLiveStoreDevtoolsMiddleware(config, { schemaPath: './schema/index.ts' })
    }

    module.exports = config
    ```

    **Explanation**

    - `addLiveStoreDevtoolsMiddleware`: This function, imported from `@livestore/devtools-expo`, adds middleware that enables LiveStore Devtools.
    - Conditional Check `if (!process.env.CI && process.stdout.isTTY)`: This condition ensures that LiveStore Devtools are only added in a local development environment and not in Continuous Integration (CI) environments like [EAS Build](https://docs.expo.dev/build/introduction/). This is crucial because enabling devtools in a CI environment could cause the build process to get stuck, especially when building for release mode. The `process.env.CI` variable indicates if the code is running in a CI environment, and `process.stdout.isTTY` checks if the terminal supports interactive output. Together, these conditions prevent devtools from being included in production builds.

</Steps>

## Define your schema

To define the data structure for your app, set up a schema that specifies the tables and fields your app uses.

- In your project root, create a `schema` folder and inside it create a file named `index.ts`. This file defines the tables and data structures for your app.

- In `index.ts`, define a table to represent a data model, such as a `todos`.

Here's an example:

```ts
import { DbSchema, makeSchema } from '@livestore/livestore'
import * as mutations from './mutations'

const todos = DbSchema.table(
  'todos',
  {
    id: DbSchema.text({ primaryKey: true }), // Unique identifier for each todo item
    text: DbSchema.text({ default: '' }), // Text content of the todo
    completed: DbSchema.boolean({ default: false }), // Status of the todo item
    deleted: DbSchema.integer({ nullable: true }), // Optional field to mark deletion
  },
  { deriveMutations: true }, // Automatically derive mutations for this table
)

export type Todo = DbSchema.FromTable.RowDecoded<typeof todos>

export const tables = {
  todos,
}

export const schema = makeSchema({
  tables,
  mutations: {
    // Add more mutations
    ...mutations,
  },
  migrations: { strategy: 'from-mutation-log' }, // Define migration strategy
})
```

## Mutations

- Create a `mutations.ts` inside the `schema` folder and add the following:

  ```ts
  import { Schema } from 'effect'
  import { defineMutation, sql } from '@livestore/livestore'

  export const addTodo = defineMutation(
    'addTodo',
    Schema.Struct({ id: Schema.String, text: Schema.String }),
    sql`INSERT INTO todos (id, text, completed) VALUES ($id, $text, false)`,
  )

  export const completeTodo = defineMutation(
    'completeTodo',
    Schema.Struct({ id: Schema.String }),
    sql`UPDATE todos SET completed = true WHERE id = $id`,
  )

  export const deleteTodo = defineMutation(
    'deleteTodo',
    Schema.Struct({ id: Schema.String, deleted: Schema.Number }),
    sql`UPDATE todos SET deleted = $deleted WHERE id = $id`,
  )
  ```

## Queries

- Write your first query

  ```ts
  import { useQuery } from '@livestore/react'
  import { querySQL, sql } from '@livestore/livestore'
  import { Schema } from 'effect'
  import { tables } from '@/schema'

  // Define a query
  const todosQuery = querySQL(sql`SELECT * FROM todos`, {
    schema: Schema.Array(tables.todos.schema),
    label: 'todos',
  })

  // Use the query
  const todos = useQuery(todosQuery)

  console.log(todos)
  // [{"id": "1", "completed": false, "deleted": null, "text": "Make coffee"}]
  ```

- Write your first mutation

  ```ts
  import { useStore } from '@livestore/react'
  import { deleteTodo } from '@/schema/mutations'

  export default function HomeScreen() {
    const { store } = useStore()
    return (
      <Button
        title="Delete my todo"
        onPress={() => {
          store.mutate(deleteTodo({ id: todos[0].id, deleted: Date.now() }))
        }}
      />
    )
  }
  ```

## Devtools

To open the devtools, run the app and from your terminal press `Shift + M`, then select LiveStore Devtools.

- That's it! You've learned the basics of LiveStore. Happy coding!

## Database location

### With Expo Go

Run `open $(find $(xcrun simctl get_app_container booted host.exp.Exponent data) -path "*/Documents/ExponentExperienceData/*livestore-expo*" -print -quit)/SQLite` to open the database in Finder.

### With development builds

The app SQLite database is stored in the app's `Library` directory (e.g. `/Users/<USERNAME>/Library/Developer/CoreSimulator/Devices/<DEVICE_ID>/data/Containers/Data/Application/<APP_ID>/Documents/SQLite/app.db`)

Run `open $(xcrun simctl get_app_container booted dev.livestore.livestore-expo data)/Documents/SQLite` to open the directory in Finder

## Further notes

- Until Expo properly supports PNPM we also need the following
  - Some workarounds in `metro.config.js` + `@babel/runtime` in `package.json`
- LiveStore doesn't yet support Expo Web (see [#130](https://github.com/livestorejs/livestore/issues/130))
